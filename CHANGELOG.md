# 更新日志

所有重要的项目变更都会记录在这个文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.6.0] - 2024-12-05

### 新增

#### 自动账号切换（Rate Limit 处理）⭐⭐⭐⭐⭐
- ✅ 自动检测 "You've reached your rate limit" 错误
- ✅ 自动切换到下一个可用的 Google 账号
- ✅ 记录已切换的账号，避免重复使用
- ✅ 支持手动选择账号
- ✅ 切换后自动重新发送请求
- ✅ 显示已切换账号数量

**功能说明**：
- 检测到 rate limit 时自动点击账号切换按钮
- 自动点击"切换账号"并跳转到 Google 账号页面
- 自动选择下一个未使用的账号
- 返回 AI Studio 后自动重新发送当前步骤
- 支持多个账号轮换使用

**使用场景**：
- 批量处理大量视频
- 避免 rate limit 中断
- 提高处理效率
- 无需人工干预

---

## [1.5.1] - 2024-12-05

### 修复

#### 上传视频优化 ⭐⭐⭐⭐⭐
- ✅ 修复 "Jsloader error" 上传失败问题
- ✅ 增强页面加载等待（使用 networkidle）
- ✅ 增加页面加载超时时间到 60 秒
- ✅ 等待页面主体元素加载完成
- ✅ 优化上传流程等待时间
- ✅ 增加 Upload File 按钮查找重试机制
- ✅ 增加文件选择器超时时间到 30 秒
- ✅ 添加智能上传进度检测
- ✅ 实时监控上传状态并输出进度

**问题说明**：
- 上传视频时出现 "Jsloader error (code #1): Timeout reached for loading script"
- 页面未完全加载导致 JavaScript 加载超时
- 操作时机不对导致上传失败

**解决方案**：
- 使用更完整的页面加载等待策略
- 增加各个步骤的等待时间
- 添加上传进度实时监控
- 提高操作成功率

---

## [1.5.0] - 2024-12-05

### 新增

#### 交互式错误处理和流程控制 ⭐⭐⭐⭐⭐
- ✅ 遇到错误不崩溃，等待用户处理
- ✅ 支持从任意步骤（1-25）恢复执行
- ✅ 支持重试当前步骤
- ✅ 支持跳过当前视频
- ✅ 支持手动干预后继续

**用户操作选项**：
- 输入步骤号 (1-25) - 从指定步骤继续
- 输入 'retry' - 重试当前步骤
- 输入 'skip' - 跳过当前视频
- 输入 'quit' - 退出程序
- 直接按 Enter - 继续下一步

#### 循环执行模式 ⭐⭐⭐⭐⭐
- ✅ 批次完成后不退出程序
- ✅ 支持更新 VideoList.csv 后继续
- ✅ 无需重启程序和浏览器
- ✅ 高效批量处理多批次视频

**工作流程**：
1. 处理一批视频
2. 批次完成，询问用户操作
3. 用户更新 VideoList.csv
4. 输入 'continue' 继续下一批
5. 或输入 'quit' 退出程序

#### 步骤级错误处理 ⭐⭐⭐⭐
- ✅ 每个步骤独立错误处理
- ✅ 保留已完成步骤的数据
- ✅ 支持步骤级重试和恢复
- ✅ 详细的错误信息和当前步骤提示

**错误处理点**：
- 更新提示词文件
- 打开 AI Studio
- 上传视频
- 发送步骤 1-25（每个步骤独立）
- 保存输出数据

---

## [1.4.3] - 2024-12-05

### 修复

#### 表格解析逻辑优化 ⭐⭐⭐
- ✅ 支持空单元格的解析
- ✅ 支持不完整行的解析（单元格数量少于表头）
- ✅ 修复 music、cover_time、title 等列数据丢失问题
- ✅ 显示每列的非空数据统计
- ✅ 改进单元格分割逻辑，保留空值
- ✅ 更详细的调试信息

**问题说明**：
- 步骤25输出的表格中，music、cover_time、title 等列并不是每行都有数据
- 旧逻辑要求每行单元格数量必须与表头一致，导致有空单元格的行被跳过
- 新逻辑能够正确处理空单元格和不完整的行

---

## [1.4.2] - 2024-12-05

### 改进

#### 最终处理脚本执行优化 ⭐⭐
- ✅ 添加详细的执行前警告
- ✅ 说明 process_video.py 需要配置资源文件夹
- ✅ 显示配置要求（字体、音乐、FFmpeg）
- ✅ 执行后显示结果和错误提示
- ✅ 提供解决方案建议
- ✅ 允许配置错误时的正常报错

---

## [1.4.1] - 2024-12-05

### 修复

#### Excel 合并和语法错误修复 ⭐⭐
- ✅ 跳过 Excel 临时文件（.~ 和 ~$ 开头）
- ✅ 修复 process_video.py 语法错误
- ✅ 改进日志输出
- ✅ 显示合并数据统计

---

## [1.4.0] - 2024-12-05

### 新增

#### 智能数据解析功能 ⭐⭐⭐
- ✅ 添加 `parse_table_response()` 方法
- ✅ 自动解析 AI 响应中的表格数据
- ✅ 支持 Markdown 表格格式
- ✅ 支持 JSON 格式
- ✅ 支持 CSV 格式
- ✅ 自动提取 9个标准字段（filename, start, end, Folder, Folder2, Folder3, music, cover_time, title）
- ✅ 显示解析后的列名和数据统计

---

## [1.3.9] - 2024-12-05

### 修复

#### 更新视频处理流程文档 ⭐
- ✅ 删除执行 get_duration.bat 的步骤
- ✅ VideoList.csv 已预先生成，无需手动执行
- ✅ 简化流程说明
- ✅ 更新注意事项

---

## [1.3.8] - 2024-12-05

### 新增

#### 打包功能 ⭐⭐⭐
- ✅ 添加 PyInstaller 打包支持
- ✅ 创建打包脚本（build.py, build.sh, build.bat）
- ✅ 创建打包配置文件（build.spec）
- ✅ 自动检查和安装依赖
- ✅ 支持 Windows/macOS/Linux
- ✅ 生成独立可执行文件
- ✅ 详细的打包文档

---

## [1.3.7] - 2024-12-05

### 修复

#### process_video.py 语法错误 ⭐⭐
- ✅ 修复 f-string 中嵌套引号导致的语法错误
- ✅ 使用中间变量分离路径处理逻辑
- ✅ 提高代码可读性
- ✅ 添加注释说明

---

## [1.3.6] - 2024-12-05

### 修复

#### 延长按钮等待超时时间 ⭐⭐⭐
- ✅ 将 WAIT_BUTTON_ENABLED 从 10 秒延长到 300 秒（5分钟）
- ✅ 适应慢速网络和大文件上传
- ✅ 添加每 10 秒的进度提示
- ✅ 显示已等待时间
- ✅ 超时后自动使用快捷键备用方案

---

## [1.3.5] - 2024-12-05

### 修复

#### Content Blocked 检测去重优化 ⭐⭐⭐
- ✅ 修复 Content blocked 重复检测问题
- ✅ 添加冷却时间机制（默认 60 秒）
- ✅ 避免重复发送"继续"
- ✅ 每个视频独立重置标记
- ✅ 可配置冷却时间

---

## [1.3.4] - 2024-12-05

### 修复

#### 发送提示词流程优化 ⭐⭐⭐
- ✅ 修复发送按钮未触发的问题
- ✅ 填入文字后等待 Run 按钮变为可用
- ✅ 检测按钮的 aria-disabled 属性
- ✅ 按钮可用后再点击发送
- ✅ 添加详细的日志输出
- ✅ 提供快捷键备用方案

---

## [1.3.3] - 2024-12-05

### 修复

#### 上传后关闭浮窗菜单 ⭐⭐⭐
- ✅ 上传完成后自动关闭浮窗菜单
- ✅ 添加 0.3 秒延迟确保文件选择完成
- ✅ 使用 Escape 键关闭菜单（主要方法）
- ✅ 备用方法：点击页面其他区域
- ✅ 确保 Run 按钮可用
- ✅ 避免菜单遮挡界面

### 新增

#### 验证脚本
- ✅ 添加 `verify_menu_close.py` 验证菜单关闭功能
- ✅ 检查菜单是否正确关闭
- ✅ 检查 Run 按钮是否可用
- ✅ 检查按钮是否被遮挡

---

## [1.3.2] - 2024-12-05

### 改进

#### 智能等待机制 ⭐⭐⭐
- ✅ 通过检测 Run 按钮状态判断 AI 是否运行
- ✅ 按钮显示 "Stop" 时等待
- ✅ 按钮显示 "Run" 时继续
- ✅ 更准确的响应完成检测
- ✅ 每 10 秒输出等待状态
- ✅ 避免过早发送下一步

---

## [1.3.1] - 2024-12-05

### 改进

#### 视频上传流程优化
- ✅ 更新为两步上传流程
- ✅ 先点击添加按钮（add_circle 图标）
- ✅ 再点击 Upload File 按钮
- ✅ 支持 file chooser 事件
- ✅ 更新选择器配置
- ✅ 增加详细的上传日志

---

## [1.3.0] - 2024-12-05

### 新增

#### 用户确认机制 ⭐⭐⭐
- ✅ 打开页面后等待用户确认
- ✅ 确保用户已登录并进入对话界面
- ✅ 友好的确认提示
- ✅ 支持按 Enter 键继续
- ✅ 添加 `WAIT_USER_CONFIRMATION` 配置选项
- ✅ 可选择跳过用户确认

### 改进

- ✅ 优化用户交互流程
- ✅ 增加操作确认步骤
- ✅ 更新所有文档，添加用户确认说明

---

## [1.2.0] - 2024-12-05

### 新增

#### 系统 Chrome 支持 ⭐⭐⭐
- ✅ 支持使用系统安装的 Chrome 浏览器
- ✅ 支持使用 Chrome 默认用户配置
- ✅ 已登录的 Google 账号直接可用
- ✅ 无需重复登录
- ✅ 自动检测和回退机制
- ✅ 添加 `USE_SYSTEM_CHROME` 配置选项

### 改进

- ✅ 优化浏览器启动逻辑
- ✅ 支持跨平台 Chrome 路径检测（macOS/Windows/Linux）
- ✅ 改进关闭浏览器的逻辑
- ✅ 更新所有文档，添加浏览器配置说明

---

## [1.1.0] - 2024-12-05

### 新增

#### 会话管理功能
- ✅ 自动保存浏览器会话状态
- ✅ 自动加载已保存的会话
- ✅ 首次登录后无需重复登录
- ✅ 会话状态保存到 `.browser_session/` 目录
- ✅ 添加 `clear_session.py` 清除会话工具

### 改进

- ✅ 优化登录流程，自动检测登录状态
- ✅ 添加等待用户登录的友好提示
- ✅ 关闭浏览器时自动保存会话
- ✅ 更新所有文档，添加会话管理说明

---

## [1.0.0] - 2024-12-05

### 新增

#### 核心功能
- ✅ 视频列表自动读取功能
- ✅ 提示词文件自动管理
- ✅ 浏览器自动化控制（基于 Playwright）
- ✅ 视频自动上传到 Google AI Studio
- ✅ 25 步 AI 对话自动执行
- ✅ "Content blocked" 异常自动检测和处理
- ✅ 输出数据自动保存为 Excel
- ✅ 多个 Excel 文件自动合并
- ✅ 批量视频循环处理

#### 辅助功能
- ✅ 完整的日志系统（支持文件和控制台输出）
- ✅ 关键步骤自动截图
- ✅ 失败操作自动重试（最多 3 次）
- ✅ 灵活的配置管理系统
- ✅ 浏览器连接测试工具
- ✅ 功能演示脚本

#### 文档
- ✅ README.md - 项目主页
- ✅ 开始使用.md - 5 分钟快速上手指南
- ✅ 使用指南.md - 详细使用教程
- ✅ 快速参考.md - 常用命令和配置速查
- ✅ 项目说明.md - 项目架构和技术栈
- ✅ 项目总结.md - 功能清单和完成总结
- ✅ 视频处理流程.md - 业务流程说明
- ✅ 文件清单.md - 所有文件列表
- ✅ 检查清单.md - 项目完成检查
- ✅ 项目完成报告.md - 详细完成报告

#### 工具脚本
- ✅ setup.sh - 自动安装脚本
- ✅ run.sh - 快速启动脚本
- ✅ test_connection.py - 测试工具
- ✅ demo.py - 演示脚本

#### 配置文件
- ✅ config.py - 集中配置管理
- ✅ requirements.txt - Python 依赖清单
- ✅ .gitignore - Git 忽略规则
- ✅ VERSION - 版本号文件
- ✅ LICENSE - MIT 许可证
- ✅ CHANGELOG.md - 本文件

### 技术特性

- 🎯 **智能等待机制** - 自动检测页面加载和 AI 响应状态
- 🛡️ **健壮异常处理** - 完善的错误检测、日志和重试机制
- ⚙️ **灵活配置系统** - 所有参数可通过配置文件调整
- 📝 **完整日志记录** - 多级别日志，便于调试和追踪
- 📸 **自动截图功能** - 关键步骤自动截图，便于问题排查
- 🔄 **自动重试机制** - 失败操作自动重试，提高成功率

### 性能

- ⚡ 单视频处理时间：5-10 分钟
- ⚡ 25 步对话时间：3-5 分钟
- ⚡ 内存使用：200-500 MB
- ⚡ CPU 使用：低（主要等待网络响应）

### 兼容性

- ✅ Python 3.8+
- ✅ macOS / Linux / Windows
- ✅ Chromium 浏览器
- ✅ Google AI Studio

---

## [未来计划]

### 短期改进

- [ ] 添加进度条显示
- [ ] 优化选择器自动检测
- [ ] 支持断点续传
- [ ] 添加更多视频格式支持

### 中期改进

- [ ] 添加 GUI 界面
- [ ] 支持多浏览器（Firefox, Safari）
- [ ] 添加性能监控
- [ ] 优化内存使用

### 长期改进

- [ ] 支持分布式处理
- [ ] 添加 API 接口
- [ ] 支持更多 AI 平台
- [ ] 添加数据分析功能

---

## 版本说明

### 版本号格式

版本号格式：`主版本号.次版本号.修订号`

- **主版本号**：不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 更新类型

- **新增** - 新功能
- **变更** - 现有功能的变更
- **弃用** - 即将移除的功能
- **移除** - 已移除的功能
- **修复** - 问题修复
- **安全** - 安全相关的修复

---

## 贡献指南

如果你想为项目做出贡献：

1. Fork 项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

---

**当前版本**: v1.0.0  
**发布日期**: 2024-12-05  
**状态**: ✅ 稳定版本
