# 🔧 按钮等待超时优化

## 问题描述

网络慢时视频上传时间长，Run 按钮长时间处于 disabled 状态，等待 10 秒后超时导致点击失败。

**错误信息**：
```
点击 Run 按钮失败: Locator.click: Timeout 60000ms exceeded.
```

---

## 解决方案

### 核心改进

将等待按钮可用的超时时间从 **10 秒** 延长到 **300 秒（5分钟）**，适应慢速网络和大文件上传。

### 配置更新

```python
# config.py
WAIT_BUTTON_ENABLED = 300  # 从 10 秒改为 300 秒
```

### 代码优化

```python
# 1. 延长等待时间
max_wait = 300  # 5 分钟

# 2. 添加进度提示
while waited < max_wait:
    if is_disabled != 'true':
        logger.info(f"✅ 按钮已可用（等待了 {waited:.1f} 秒）")
        break
    
    # 每 10 秒输出进度
    if waited - last_log_time >= 10:
        logger.info(f"⏳ 等待中... ({waited:.0f}/{max_wait} 秒)")
        last_log_time = waited
    
    time.sleep(0.5)
    waited += 0.5

# 3. 超时后使用备用方案
if waited >= max_wait:
    logger.warning("⚠️ 等待超时，尝试使用快捷键")
    page.keyboard.press("Control+Enter")
```

---

## 日志示例

### 快速网络（30秒）

```
✅ 已填入提示词
⏳ 等待 Run 按钮可用...
⏳ 等待按钮可用中... (10/300 秒)
⏳ 等待按钮可用中... (20/300 秒)
✅ Run 按钮已可用（等待了 28.5 秒）
✅ 已点击 Run 按钮
```

### 慢速网络（2分钟）

```
✅ 已填入提示词
⏳ 等待 Run 按钮可用...
⏳ 等待按钮可用中... (10/300 秒)
⏳ 等待按钮可用中... (20/300 秒)
...
⏳ 等待按钮可用中... (110/300 秒)
⏳ 等待按钮可用中... (120/300 秒)
✅ Run 按钮已可用（等待了 125.5 秒）
✅ 已点击 Run 按钮
```

### 超时情况（5分钟+）

```
✅ 已填入提示词
⏳ 等待 Run 按钮可用...
...
⏳ 等待按钮可用中... (290/300 秒)
⚠️ 等待超时（300 秒），尝试使用快捷键
```

---

## 配置建议

根据网络速度和视频大小调整：

| 网络速度 | 视频大小 | 推荐配置 |
|---------|---------|---------|
| 快速 | 小（<50MB） | 60 秒 |
| 标准 | 中（50-100MB） | 180 秒 |
| 慢速 | 大（100-200MB） | 300 秒 |
| 很慢 | 很大（>200MB） | 600 秒 |

```python
# 快速网络
WAIT_BUTTON_ENABLED = 60

# 标准网络（默认）
WAIT_BUTTON_ENABLED = 300

# 慢速网络
WAIT_BUTTON_ENABLED = 600
```

---

## 关键特性

1. ✅ **延长超时** - 5 分钟足够大多数情况
2. ✅ **进度提示** - 每 10 秒显示进度
3. ✅ **显示时间** - 知道等了多久
4. ✅ **备用方案** - 超时后使用快捷键
5. ✅ **可配置** - 根据需要调整

---

## 效果

- ✅ 解决慢速网络超时问题
- ✅ 支持大文件上传
- ✅ 提供清晰的进度反馈
- ✅ 自动备用方案
- ✅ 提高成功率

---

**版本**: v1.3.6  
**更新日期**: 2024-12-05  
**状态**: ✅ 已实现
