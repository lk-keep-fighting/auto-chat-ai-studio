# 步骤25数据保存测试指南

## 测试目的

测试步骤25的数据提取和保存功能是否正常工作。

## 测试内容

1. ✅ 打开 AI Studio
2. ✅ 发送步骤25测试提示词
3. ✅ 等待AI生成测试数据（10行）
4. ✅ 从HTML DOM提取表格数据
5. ✅ 保存为Excel文件
6. ✅ 验证文件内容

## 快速开始

### 1. 运行测试脚本

```bash
python test_step25.py
```

### 2. 按照提示操作

程序会自动打开浏览器，然后等待你确认：

```
请确认以下事项：
1. ✅ 已登录 Google 账号
2. ✅ 已进入 AI Studio 对话界面
3. ✅ 页面加载完成

✅ 确认无误后，按 Enter 键继续测试...
```

### 3. 等待测试完成

程序会自动：
- 发送测试提示词
- 等待AI响应
- 提取表格数据
- 保存为Excel文件
- 验证保存结果

### 4. 查看测试结果

测试成功会显示：

```
✅ 文件已创建: test_output/test_step25/step_25_output.xlsx
📊 文件大小: 12345 字节
📊 数据行数: 10
📊 数据列数: 8
📋 列名: start, end, folder1, folder2, folder3, music, cover_time, title

前3行数据:
   start    end  folder1  folder2  folder3  music  cover_time  title
0  00:00  00:10  测试1    测试1    测试1    音乐1   00:05      标题1
1  00:10  00:20  测试2    测试2    测试2    音乐2   00:15      标题2
2  00:20  00:30  测试3    测试3    测试3    音乐3   00:25      标题3

🎉 测试成功！
```

## 测试提示词

```
步骤25:按输出格式输出10行测试数据

【输出格式】
请直接输出表格。表头如下：
| start | end | folder1 | folder2 | folder3 | music | cover_time | title |
```

## 输出文件

- **Excel文件**: `test_output/test_step25/step_25_output.xlsx`
- **日志文件**: `test_step25.log`

## 查看日志

### 实时查看

```bash
tail -f test_step25.log
```

### 查看完整日志

```bash
cat test_step25.log
```

## 关键日志说明

### 1. 数据提取阶段

```
📊 步骤 5: 提取步骤25数据
📊 数据类型: <class 'list'>
📊 数据量: 10
📋 第一条数据: {'start': '00:00', 'end': '00:10', ...}
📋 数据列: ['start', 'end', 'folder1', 'folder2', 'folder3', 'music', 'cover_time', 'title']
```

**说明**：
- 数据类型应该是 `list`（从DOM提取）
- 数据量应该是 10（测试数据）
- 第一条数据应该是字典格式
- 数据列应该包含8个字段

### 2. 数据保存阶段

```
💾 步骤 6: 保存数据
保存到: test_output
💾 保存输出数据到: test_output/test_step25
📊 待保存的步骤: [25]
🔍 处理步骤 25, 数据类型: <class 'list'>, 数据长度: 10
📊 步骤 25 数据: 10 行 x 8 列
📋 列名: start, end, folder1, folder2, folder3, music, cover_time, title
✅ 保存步骤 25 数据: step_25_output.xlsx (12345 字节)
```

**说明**：
- 应该显示待保存的步骤 `[25]`
- 数据类型应该是 `list`
- 数据长度应该是 10
- 应该显示 10 行 x 8 列
- 应该显示文件大小（字节）

### 3. 验证阶段

```
✅ 步骤 7: 验证保存结果
✅ 文件已创建: test_output/test_step25/step_25_output.xlsx
📊 文件大小: 12345 字节
📊 数据行数: 10
📊 数据列数: 8
📋 列名: start, end, folder1, folder2, folder3, music, cover_time, title
```

**说明**：
- 文件应该存在
- 文件大小应该大于 0
- 数据行数应该是 10
- 数据列数应该是 8

## 故障排除

### 问题1：数据量为0

```
📊 数据量: 0
❌ 未提取到任何数据
```

**可能原因**：
- AI还没有生成完数据就提取了
- HTML结构变化，选择器失效
- 表格元素未找到

**解决方案**：
1. 检查浏览器中是否显示了表格
2. 手动等待AI完成后再按Enter
3. 检查 `extract_table_from_dom()` 方法的选择器

### 问题2：数据类型是字符串

```
📊 数据类型: <class 'str'>
📝 文本数据预览: ...
```

**可能原因**：
- DOM提取失败，回退到文本提取
- 表格元素未找到

**解决方案**：
1. 检查日志中的 "从DOM提取表格失败" 警告
2. 检查HTML结构是否变化
3. 更新 `extract_table_from_dom()` 方法的选择器

### 问题3：文件未创建

```
❌ 文件未创建: test_output/test_step25/step_25_output.xlsx
```

**可能原因**：
- 保存过程出现异常
- 数据为空被跳过
- 文件路径错误

**解决方案**：
1. 检查日志中的错误信息
2. 检查 "⚠️ 步骤 25 数据为空，跳过" 警告
3. 检查文件权限

### 问题4：文件大小为0

```
✅ 文件已创建: ...
📊 文件大小: 0 字节
```

**可能原因**：
- DataFrame为空
- 写入过程出现异常

**解决方案**：
1. 检查日志中的 "📊 步骤 25 数据: X 行 x Y 列"
2. 如果行数为0，说明数据为空
3. 检查数据提取逻辑

## 成功标准

测试成功需要满足：

- ✅ 数据类型是 `list`
- ✅ 数据量是 10
- ✅ 数据列包含8个字段
- ✅ 文件被创建
- ✅ 文件大小 > 0
- ✅ Excel可以正常打开
- ✅ 数据行数是 10
- ✅ 数据列数是 8

## 下一步

如果测试成功，说明步骤25的数据提取和保存功能正常。

如果测试失败，请：
1. 查看详细日志 `test_step25.log`
2. 根据故障排除指南定位问题
3. 检查HTML结构是否变化
4. 更新选择器或提取逻辑

## 清理测试文件

```bash
# 删除测试输出
rm -rf test_output

# 删除测试日志
rm test_step25.log
```
