# 步骤23和步骤25测试指南

## 测试目的

同时测试步骤23（SRT文件生成）和步骤25（表格数据生成）的数据提取和保存功能。

## 测试内容

### 步骤23：SRT文件生成

**提示词**：
```
步骤23：【角色设定】按内容要求生成2个srt文件的测试数据

【内容要求】
风格：电影解说旁白风格（第三人称，情绪饱满）。
覆盖：旁白内容必须填满计算出的时长，不要留白。

输出要求：
请输出修正后的纯旁白英文 SRT 文件。
格式：标准的 .srt 格式。
所有时间戳必须严格使用 hh:mm:ss,ms 格式（小时:分钟:秒,毫秒），并确保每一个时间戳都完全符合规范。
```

**预期输出**：
- SRT格式的字幕文件内容
- 包含时间戳和旁白文本
- 保存为Excel文件

### 步骤25：表格数据生成

**提示词**：
```
步骤25:按输出格式输出10行测试数据

【输出格式】
请直接输出表格。表头如下：
| start | end | folder1 | folder2 | folder3 | music | cover_time | title |
```

**预期输出**：
- 10行表格数据
- 8列（start, end, folder1, folder2, folder3, music, cover_time, title）
- 保存为Excel文件

## 快速开始

### 运行测试

```bash
# 方法1：使用启动脚本
./test_step23_25.sh

# 方法2：直接运行
python test_step23_25.py
```

### 测试流程

1. **初始化浏览器** - 启动系统Chrome
2. **打开AI Studio** - 自动访问Google AI Studio
3. **等待用户确认** - 确认已登录并进入对话界面
4. **测试步骤23** - 发送SRT文件生成提示词
5. **等待AI响应** - 等待AI生成SRT内容
6. **提取并保存** - 提取数据并保存为Excel
7. **测试步骤25** - 发送表格数据生成提示词
8. **等待AI响应** - 等待AI生成表格
9. **提取并保存** - 提取表格数据并保存为Excel
10. **验证结果** - 显示测试结果汇总

## 输出文件

### 步骤23输出

- **Excel文件**: `assets/Process_Folder/test_步骤23_SRT文件/step_23_output.xlsx`
- **页面HTML**: `test_output/step23_page.html`
- **截图**: `screenshots/before_extract_step23.png`

### 步骤25输出

- **Excel文件**: `assets/Process_Folder/test_步骤25_表格数据/step_25_output.xlsx`
- **页面HTML**: `test_output/step25_page.html`
- **截图**: `screenshots/before_extract_step25.png`

### 日志文件

- **测试日志**: `test_step23_25.log`

## 成功标准

### 步骤23成功标准

- ✅ 提取到SRT格式的文本数据
- ✅ 数据类型是字符串
- ✅ 包含时间戳（hh:mm:ss,ms格式）
- ✅ 包含旁白文本
- ✅ 保存为Excel文件
- ✅ 文件大小 > 0

### 步骤25成功标准

- ✅ 提取到表格数据
- ✅ 数据类型是列表（List[Dict]）
- ✅ 10行数据
- ✅ 8列数据
- ✅ 列名正确
- ✅ 保存为Excel文件
- ✅ 文件大小 > 0

## 预期日志

### 成功的日志

```
🧪 步骤23和步骤25数据保存测试工具
============================================================

测试内容：
1. 初始化浏览器
2. 打开 AI Studio
3. 等待用户确认
4. 测试步骤23（SRT文件生成）
5. 测试步骤25（表格数据生成）
6. 验证保存结果

============================================================

📱 步骤 1: 初始化浏览器
✅ 系统 Chrome 已启动

🌐 步骤 2: 打开 AI Studio
✅ 已打开 AI Studio

⏸️  步骤 3: 等待用户确认
[用户按Enter]

============================================================
📝 测试步骤23：SRT文件生成
============================================================

📝 步骤 23: 发送测试提示词
✅ 提示词已发送

⏳ 等待AI响应步骤 23...
✅ AI响应完成

📊 提取步骤 23 数据
📊 数据类型: <class 'str'>
📊 数据量: 2345
📝 文本数据预览: 1
00:00:00,000 --> 00:00:05,000
In the heart of the city...

💾 保存步骤 23 数据
✅ 文件已创建: .../step_23_output.xlsx
📊 文件大小: 8765 字节

🎉 步骤 23 测试成功！

============================================================
📝 测试步骤25：表格数据生成
============================================================

📝 步骤 25: 发送测试提示词
✅ 提示词已发送

⏳ 等待AI响应步骤 25...
✅ AI响应完成

📊 提取步骤 25 数据
📊 数据类型: <class 'list'>
📊 数据量: 10
📋 第一条数据: {'start': '00:00:00', 'end': '00:00:30', ...}

💾 保存步骤 25 数据
✅ 文件已创建: .../step_25_output.xlsx
📊 文件大小: 5432 字节

🎉 步骤 25 测试成功！

============================================================
📊 测试结果汇总
============================================================
步骤23: ✅ 成功
步骤25: ✅ 成功

🎉 所有测试通过！
```

## 查看结果

### 查看Excel文件

```bash
# 步骤23
open "assets/Process_Folder/test_步骤23_SRT文件/step_23_output.xlsx"

# 步骤25
open "assets/Process_Folder/test_步骤25_表格数据/step_25_output.xlsx"
```

### 查看日志

```bash
# 查看完整日志
cat test_step23_25.log

# 实时查看日志
tail -f test_step23_25.log
```

### 验证数据

```bash
# 验证步骤23
python3 -c "import pandas as pd; df = pd.read_excel('assets/Process_Folder/test_步骤23_SRT文件/step_23_output.xlsx'); print(df)"

# 验证步骤25
python3 -c "import pandas as pd; df = pd.read_excel('assets/Process_Folder/test_步骤25_表格数据/step_25_output.xlsx'); print(df)"
```

## 故障排除

### 问题1：步骤23数据为空

**可能原因**：
- AI生成的不是SRT格式
- 响应元素为空
- 提取逻辑有问题

**解决方案**：
1. 查看保存的HTML文件
2. 检查AI是否真的生成了SRT内容
3. 查看日志中的"数据类型"和"数据量"

### 问题2：步骤25表格为空

**可能原因**：
- 表格还没有渲染
- 响应元素为空
- 表格选择器不对

**解决方案**：
1. 查看保存的HTML文件
2. 检查是否有表格元素
3. 增加等待时间

### 问题3：两个步骤都失败

**可能原因**：
- 浏览器未正确初始化
- 未登录Google账号
- 网络问题

**解决方案**：
1. 检查浏览器是否打开
2. 确认已登录Google账号
3. 检查网络连接

## 清理测试文件

```bash
# 删除测试输出
rm -rf "assets/Process_Folder/test_步骤23_SRT文件"
rm -rf "assets/Process_Folder/test_步骤25_表格数据"
rm -rf test_output

# 删除测试日志
rm test_step23_25.log
```

## 相关文档

- **[步骤25测试指南.md](步骤25测试指南.md)** - 步骤25单独测试
- **[v1.7.6更新说明.md](v1.7.6更新说明.md)** - 智能选择响应
- **[使用指南.md](使用指南.md)** - 完整使用教程

## 注意事项

- ⚠️ 测试会打开真实的浏览器
- ⚠️ 需要登录Google账号
- ⚠️ 需要网络连接
- ⚠️ AI生成数据需要时间，请耐心等待
- ⚠️ 测试完成后浏览器会保持打开，按Enter关闭
- ⚠️ 两个步骤会依次执行，总时间约2-5分钟

## 版本信息

- **版本**: v1.7.6
- **更新日期**: 2024-12-06
- **测试工具**: test_step23_25.py
- **启动脚本**: test_step23_25.sh
