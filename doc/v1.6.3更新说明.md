# ğŸ”§ v1.6.3 æ›´æ–°è¯´æ˜

## æ›´æ–°æ—¥æœŸ

2024-12-06

---

## ğŸ¯ ä¿®å¤å†…å®¹

### è´¦å·åˆ‡æ¢è¯†åˆ«é—®é¢˜

**é—®é¢˜æè¿°**ï¼š
- åˆ‡æ¢è´¦å·åæ— æ³•æ­£ç¡®è¯†åˆ«æ–°è´¦å·
- `get_current_account()` ä¸€ç›´è¿”å›æ—§è´¦å·
- å¯¼è‡´ `switched_accounts` è®°å½•é”™è¯¯
- é‡å¤é€‰æ‹©åŒä¸€ä¸ªè´¦å·
- æœ€ç»ˆæç¤º"æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„è´¦å·"

**æ—¥å¿—ç¤ºä¾‹**ï¼ˆv1.6.2ï¼‰ï¼š
```
ğŸ“§ å½“å‰è´¦å·: liusir2606@gmail.com
ğŸ“§ é€‰æ‹©è´¦å·: kun liuliusir2606@gmail.com
âœ… å·²ç‚¹å‡»è´¦å·
âœ… å·²è¿”å› AI Studio
âœ… è´¦å·åˆ‡æ¢å®Œæˆ
ğŸ“Š å·²åˆ‡æ¢è´¦å·æ•°: 2

[å†æ¬¡é‡åˆ° rate limit]

ğŸ“§ å½“å‰è´¦å·: liusir2606@gmail.com  â† è¿˜æ˜¯æ—§è´¦å·ï¼
ğŸ“§ é€‰æ‹©è´¦å·: jie123 samsamjiji123345@gmail.com
âœ… å·²ç‚¹å‡»è´¦å·
âœ… å·²è¿”å› AI Studio
âœ… è´¦å·åˆ‡æ¢å®Œæˆ
ğŸ“Š å·²åˆ‡æ¢è´¦å·æ•°: 3

[å†æ¬¡é‡åˆ° rate limit]

ğŸ“§ å½“å‰è´¦å·: liusir2606@gmail.com  â† è¿˜æ˜¯æ—§è´¦å·ï¼
âš ï¸ æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„è´¦å·  â† å› ä¸ºè®°å½•é”™è¯¯
```

---

## âœ¨ æ”¹è¿›æ–¹æ¡ˆ

### 1. å¢å¼º `get_current_account()` æ–¹æ³• â­â­â­â­â­

**é—®é¢˜æ ¹æº**ï¼š
- é¡µé¢æ›´æ–°éœ€è¦æ—¶é—´
- å•ä¸€æå–æ–¹æ³•ä¸å¤Ÿå¯é 
- æ²¡æœ‰ç­‰å¾…é¡µé¢ç¨³å®š

**æ”¹è¿›æªæ–½**ï¼š

#### 1.1 å¢åŠ ç­‰å¾…æ—¶é—´
```python
def get_current_account(self):
    # ç­‰å¾…é¡µé¢ç¨³å®š
    time.sleep(2)
    
    # ç­‰å¾…æŒ‰é’®å¯è§
    button.wait_for(state="visible", timeout=5000)
```

#### 1.2 å¤šç§æå–æ–¹æ³•
```python
# æ–¹æ³•1: ä» inner_text æå–
text = button.inner_text()
if '@' in text:
    account_text = text.strip()

# æ–¹æ³•2: ä»å­å…ƒç´ ä¸­æŸ¥æ‰¾é‚®ç®±
email_span = button.locator('span:has-text("@")').first
account_text = email_span.inner_text().strip()

# æ–¹æ³•3: ä» aria-label æˆ– title å±æ€§æå–
aria_label = button.get_attribute('aria-label')
if aria_label and '@' in aria_label:
    account_text = aria_label.strip()
```

#### 1.3 è°ƒè¯•æ—¥å¿—
```python
if account_text and '@' in account_text:
    logger.debug(f"æ£€æµ‹åˆ°å½“å‰è´¦å·: {account_text}")
    return account_text
```

---

### 2. æ”¹è¿›è´¦å·é€‰æ‹©é€»è¾‘ â­â­â­â­â­

**é—®é¢˜**ï¼š
- è´¦å·æå–ä¸å¤Ÿå‡†ç¡®
- æ²¡æœ‰éªŒè¯åˆ‡æ¢ç»“æœ
- ç¼ºå°‘ç»Ÿè®¡ä¿¡æ¯

**æ”¹è¿›æªæ–½**ï¼š

#### 2.1 å¤šç§è´¦å·æå–æ–¹æ³•
```python
# æ–¹æ³•1: ä» data-identifier å±æ€§æå–
identifier = account.get_attribute('data-identifier')
if identifier and '@' in identifier:
    account_text = identifier.strip()

# æ–¹æ³•2: ä» data-email å±æ€§æå–
email = account.get_attribute('data-email')
if email and '@' in email:
    account_text = email.strip()

# æ–¹æ³•3: ä» inner_text æå–ï¼ˆä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼‰
text = account.inner_text()
if '@' in text:
    import re
    email_match = re.search(r'[\w\.-]+@[\w\.-]+\.\w+', text)
    if email_match:
        account_text = email_match.group()
```

#### 2.2 è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
```python
logger.info(f"ğŸ“Š æ‰¾åˆ° {len(all_accounts_found)} ä¸ªè´¦å·ï¼Œå…¶ä¸­ {len(available_accounts)} ä¸ªå¯ç”¨")
logger.info(f"ğŸ“‹ æ‰€æœ‰è´¦å·: {', '.join(all_accounts_found)}")
logger.info(f"ğŸ”„ å·²åˆ‡æ¢: {', '.join(self.switched_accounts)}")
```

#### 2.3 åˆ‡æ¢åéªŒè¯
```python
# éªŒè¯è´¦å·æ˜¯å¦åˆ‡æ¢æˆåŠŸ
logger.info("6ï¸âƒ£ éªŒè¯è´¦å·åˆ‡æ¢...")
new_account = self.get_current_account()
if new_account:
    logger.info(f"âœ… å½“å‰è´¦å·: {new_account}")
    if new_account != current_account:
        logger.info(f"âœ… è´¦å·åˆ‡æ¢æˆåŠŸ: {current_account} â†’ {new_account}")
        self.switched_accounts.add(new_account)
        self.current_account = new_account
    else:
        logger.warning(f"âš ï¸ è´¦å·æœªæ”¹å˜ï¼Œä»ç„¶æ˜¯: {new_account}")
```

---

## ğŸ“Š æµç¨‹å¯¹æ¯”

### ä¹‹å‰ï¼ˆv1.6.2ï¼‰

```
é‡åˆ° rate limit
  â†“
è·å–å½“å‰è´¦å·: liusir2606@gmail.com
  â†“
ç‚¹å‡»è´¦å·åˆ‡æ¢æŒ‰é’®
  â†“
é€‰æ‹©æ–°è´¦å·: kun liu...
  â†“
è¿”å› AI Studio
  â†“
[æ²¡æœ‰éªŒè¯]
  â†“
å†æ¬¡é‡åˆ° rate limit
  â†“
è·å–å½“å‰è´¦å·: liusir2606@gmail.com  â† è¿˜æ˜¯æ—§çš„ï¼
  â†“
è®°å½•é”™è¯¯ï¼Œé‡å¤é€‰æ‹©
```

**é—®é¢˜**ï¼š
- âŒ æ²¡æœ‰ç­‰å¾…é¡µé¢æ›´æ–°
- âŒ æå–æ–¹æ³•å•ä¸€
- âŒ æ²¡æœ‰éªŒè¯åˆ‡æ¢ç»“æœ
- âŒ è®°å½•é”™è¯¯çš„è´¦å·

---

### ç°åœ¨ï¼ˆv1.6.3ï¼‰

```
é‡åˆ° rate limit
  â†“
è·å–å½“å‰è´¦å·: liusir2606@gmail.com
  â†“
ç‚¹å‡»è´¦å·åˆ‡æ¢æŒ‰é’®
  â†“
æŸ¥æ‰¾æ‰€æœ‰è´¦å·ï¼ˆå¤šç§æ–¹æ³•ï¼‰
  â†“
æ˜¾ç¤ºç»Ÿè®¡: æ‰¾åˆ° 3 ä¸ªè´¦å·ï¼Œ2 ä¸ªå¯ç”¨
  â†“
é€‰æ‹©æ–°è´¦å·: kun liu...
  â†“
è¿”å› AI Studio
  â†“
ç­‰å¾…é¡µé¢ç¨³å®šï¼ˆ3ç§’ï¼‰
  â†“
éªŒè¯è´¦å·åˆ‡æ¢
  â†“
è·å–å½“å‰è´¦å·: kun liu...  â† æ­£ç¡®ï¼
  â†“
ç¡®è®¤åˆ‡æ¢æˆåŠŸ: liusir... â†’ kun liu...
  â†“
æ›´æ–°è®°å½•
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç­‰å¾…é¡µé¢æ›´æ–°
- âœ… å¤šç§æå–æ–¹æ³•
- âœ… éªŒè¯åˆ‡æ¢ç»“æœ
- âœ… å‡†ç¡®è®°å½•è´¦å·

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. å¢å¼ºçš„ `get_current_account()`

```python
def get_current_account(self):
    """è·å–å½“å‰ç™»å½•çš„è´¦å·ï¼ˆå¢å¼ºç‰ˆï¼Œç­‰å¾…é¡µé¢æ›´æ–°ï¼‰"""
    try:
        # ç­‰å¾…é¡µé¢ç¨³å®š
        time.sleep(2)
        
        # æŸ¥æ‰¾è´¦å·åˆ‡æ¢æŒ‰é’®
        for selector in account_button_selectors:
            button = self.page.locator(selector).first
            if button.count() > 0:
                # ç­‰å¾…æŒ‰é’®å¯è§
                button.wait_for(state="visible", timeout=5000)
                
                # å°è¯•å¤šç§æ–¹æ³•æå–è´¦å·
                # æ–¹æ³•1: inner_text
                # æ–¹æ³•2: å­å…ƒç´ 
                # æ–¹æ³•3: å±æ€§
                
                if account_text and '@' in account_text:
                    logger.debug(f"æ£€æµ‹åˆ°å½“å‰è´¦å·: {account_text}")
                    return account_text
        
        return None
    except Exception as e:
        logger.debug(f"è·å–å½“å‰è´¦å·æ—¶å‡ºé”™: {e}")
        return None
```

**å…³é”®æ”¹è¿›**ï¼š
- âœ… ç­‰å¾… 2 ç§’è®©é¡µé¢ç¨³å®š
- âœ… ç­‰å¾…æŒ‰é’®å¯è§
- âœ… 3 ç§æå–æ–¹æ³•
- âœ… è°ƒè¯•æ—¥å¿—

---

### 2. æ”¹è¿›çš„è´¦å·é€‰æ‹©

```python
# æ­¥éª¤5ï¼šé€‰æ‹©ä¸‹ä¸€ä¸ªå¯ç”¨è´¦å·
logger.info("4ï¸âƒ£ é€‰æ‹©ä¸‹ä¸€ä¸ªå¯ç”¨è´¦å·...")

# ç­‰å¾…è´¦å·åˆ—è¡¨åŠ è½½
time.sleep(2)

# æŸ¥æ‰¾æ‰€æœ‰å¯ç”¨è´¦å· - ä½¿ç”¨æ›´ç²¾ç¡®çš„é€‰æ‹©å™¨
available_accounts = []
all_accounts_found = []

for selector in account_selectors:
    accounts = self.page.locator(selector).all()
    for account in accounts:
        # å°è¯•å¤šç§æ–¹æ³•æå–è´¦å·ä¿¡æ¯
        # æ–¹æ³•1: data-identifier
        # æ–¹æ³•2: data-email
        # æ–¹æ³•3: inner_text + æ­£åˆ™è¡¨è¾¾å¼
        
        if account_text and '@' in account_text:
            all_accounts_found.append(account_text)
            if account_text not in self.switched_accounts:
                available_accounts.append((account, account_text))

# è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
logger.info(f"ğŸ“Š æ‰¾åˆ° {len(all_accounts_found)} ä¸ªè´¦å·ï¼Œå…¶ä¸­ {len(available_accounts)} ä¸ªå¯ç”¨")
logger.info(f"ğŸ“‹ æ‰€æœ‰è´¦å·: {', '.join(all_accounts_found)}")
logger.info(f"ğŸ”„ å·²åˆ‡æ¢: {', '.join(self.switched_accounts)}")
```

**å…³é”®æ”¹è¿›**ï¼š
- âœ… ç­‰å¾…åˆ—è¡¨åŠ è½½
- âœ… å¤šç§æå–æ–¹æ³•
- âœ… è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
- âœ… è°ƒè¯•æ—¥å¿—

---

### 3. åˆ‡æ¢åéªŒè¯

```python
# æ­¥éª¤6ï¼šç­‰å¾…è¿”å› AI Studio
time.sleep(5)
self.page.wait_for_url("**/aistudio.google.com/**", timeout=30000)

# ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½
time.sleep(3)

# éªŒè¯è´¦å·æ˜¯å¦åˆ‡æ¢æˆåŠŸ
logger.info("6ï¸âƒ£ éªŒè¯è´¦å·åˆ‡æ¢...")
new_account = self.get_current_account()
if new_account:
    logger.info(f"âœ… å½“å‰è´¦å·: {new_account}")
    if new_account != current_account:
        logger.info(f"âœ… è´¦å·åˆ‡æ¢æˆåŠŸ: {current_account} â†’ {new_account}")
        self.switched_accounts.add(new_account)
        self.current_account = new_account
    else:
        logger.warning(f"âš ï¸ è´¦å·æœªæ”¹å˜ï¼Œä»ç„¶æ˜¯: {new_account}")
```

**å…³é”®æ”¹è¿›**ï¼š
- âœ… ç­‰å¾…é¡µé¢åŠ è½½
- âœ… éªŒè¯åˆ‡æ¢ç»“æœ
- âœ… æ›´æ–°è®°å½•
- âœ… æ¸…æ™°çš„æ—¥å¿—

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

- `video_automation.py` - ä¿®å¤è´¦å·è¯†åˆ«é€»è¾‘
  - å¢å¼º `get_current_account()` æ–¹æ³•
    - å¢åŠ ç­‰å¾…æ—¶é—´
    - å¤šç§æå–æ–¹æ³•
    - è°ƒè¯•æ—¥å¿—
  - æ”¹è¿› `switch_account()` æ–¹æ³•
    - å¤šç§è´¦å·æå–æ–¹æ³•
    - è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
    - åˆ‡æ¢åéªŒè¯
    - æ­£åˆ™è¡¨è¾¾å¼æå–é‚®ç®±
- `VERSION` - æ›´æ–°åˆ° 1.6.3
- `v1.6.3æ›´æ–°è¯´æ˜.md` - æœ¬æ–‡æ¡£

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### æ—¥å¿—ç¤ºä¾‹ï¼ˆv1.6.3ï¼‰

```
============================================================
ğŸ”„ å¼€å§‹åˆ‡æ¢è´¦å·
============================================================
ğŸ“§ å½“å‰è´¦å·: liusir2606@gmail.com
1ï¸âƒ£ ç‚¹å‡»è´¦å·åˆ‡æ¢æŒ‰é’®...
âœ… å·²ç‚¹å‡»è´¦å·åˆ‡æ¢æŒ‰é’®
2ï¸âƒ£ ç‚¹å‡»åˆ‡æ¢è´¦å·æŒ‰é’®...
âœ… å·²ç‚¹å‡»åˆ‡æ¢è´¦å·æŒ‰é’®
3ï¸âƒ£ ç­‰å¾…è·³è½¬åˆ°è´¦å·åˆ‡æ¢é¡µé¢...
âœ… å·²è·³è½¬åˆ° Google è´¦å·åˆ‡æ¢é¡µé¢
4ï¸âƒ£ é€‰æ‹©ä¸‹ä¸€ä¸ªå¯ç”¨è´¦å·...
ğŸ“Š æ‰¾åˆ° 3 ä¸ªè´¦å·ï¼Œå…¶ä¸­ 2 ä¸ªå¯ç”¨
ğŸ“‹ æ‰€æœ‰è´¦å·: liusir2606@gmail.com, kun.liu@example.com, sam.ji@example.com
ğŸ”„ å·²åˆ‡æ¢: liusir2606@gmail.com
ğŸ“§ é€‰æ‹©è´¦å·: kun.liu@example.com
âœ… å·²ç‚¹å‡»è´¦å·
5ï¸âƒ£ ç­‰å¾…è¿”å› AI Studio...
âœ… å·²è¿”å› AI Studio
6ï¸âƒ£ éªŒè¯è´¦å·åˆ‡æ¢...
âœ… å½“å‰è´¦å·: kun.liu@example.com  â† æ­£ç¡®è¯†åˆ«ï¼
âœ… è´¦å·åˆ‡æ¢æˆåŠŸ: liusir2606@gmail.com â†’ kun.liu@example.com
============================================================
âœ… è´¦å·åˆ‡æ¢å®Œæˆ
ğŸ“Š å·²åˆ‡æ¢è´¦å·æ•°: 2
============================================================
```

---

## ğŸ’¡ è°ƒè¯•å»ºè®®

### å¦‚æœä»ç„¶æ— æ³•è¯†åˆ«è´¦å·

1. **æ£€æŸ¥é¡µé¢å…ƒç´ **ï¼š
   ```python
   # åœ¨ get_current_account() ä¸­æ·»åŠ 
   logger.info(f"æŒ‰é’® HTML: {button.inner_html()}")
   logger.info(f"æŒ‰é’®æ–‡æœ¬: {button.inner_text()}")
   logger.info(f"æŒ‰é’®å±æ€§: {button.get_attribute('aria-label')}")
   ```

2. **æŸ¥çœ‹æˆªå›¾**ï¼š
   - `account_switched.png` - åˆ‡æ¢åçš„é¡µé¢
   - æ£€æŸ¥è´¦å·æŒ‰é’®çš„å®é™…å†…å®¹

3. **æ‰‹åŠ¨æµ‹è¯•**ï¼š
   ```python
   # åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œ
   document.querySelector('button.account-switcher-button').innerText
   ```

4. **è°ƒæ•´ç­‰å¾…æ—¶é—´**ï¼š
   ```python
   # å¦‚æœç½‘ç»œæ…¢ï¼Œå¢åŠ ç­‰å¾…æ—¶é—´
   time.sleep(5)  # ä» 2 ç§’æ”¹ä¸º 5 ç§’
   ```

---

## ğŸ‰ æ€»ç»“

v1.6.3 ä¿®å¤äº†è´¦å·åˆ‡æ¢è¯†åˆ«é—®é¢˜ï¼š

1. âœ… **å¢å¼ºè´¦å·è·å–** - å¤šç§æ–¹æ³•ï¼Œæ›´å¯é 
2. âœ… **ç­‰å¾…é¡µé¢æ›´æ–°** - ç¡®ä¿æ•°æ®å‡†ç¡®
3. âœ… **æ”¹è¿›è´¦å·é€‰æ‹©** - æ­£åˆ™è¡¨è¾¾å¼æå–
4. âœ… **åˆ‡æ¢åéªŒè¯** - ç¡®è®¤åˆ‡æ¢æˆåŠŸ
5. âœ… **è¯¦ç»†æ—¥å¿—** - ä¾¿äºè°ƒè¯•
6. âœ… **ç»Ÿè®¡ä¿¡æ¯** - äº†è§£è´¦å·çŠ¶æ€

**è®©è´¦å·åˆ‡æ¢æ›´åŠ å¯é å’Œæ™ºèƒ½ï¼**

---

**ç‰ˆæœ¬**: v1.6.3  
**å‘å¸ƒæ—¥æœŸ**: 2024-12-06  
**æ›´æ–°ç±»å‹**: ä¿®å¤  
**æ¨èç­‰çº§**: â­â­â­â­â­  
**å¿…é¡»å‡çº§**: å¼ºçƒˆæ¨èï¼ˆä¿®å¤å…³é”®é—®é¢˜ï¼‰
