# æ­¥éª¤è·³è¿‡é—®é¢˜åˆ†æ

## é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šï¼š**æ­¥éª¤3è¿˜æœªè¿”å›ï¼Œæ­¥éª¤4å°±å·²ç»å‘é€**

è¿™æ„å‘³ç€ç¨‹åºåœ¨æ­¥éª¤3çš„AIè¿˜åœ¨ç”Ÿæˆå“åº”æ—¶ï¼Œå°±å¼€å§‹å‘é€æ­¥éª¤4çš„æç¤ºè¯äº†ã€‚

## å½“å‰æµç¨‹åˆ†æ

### æ­£å¸¸æµç¨‹ï¼ˆåº”è¯¥æ˜¯è¿™æ ·ï¼‰

```
æ­¥éª¤3:
1. send_prompt(prompt, step_number=3)  â† å‘é€æç¤ºè¯
2. wait_for_response(step_number=3)    â† ç­‰å¾…AIå®Œæˆ
3. extract_response(step_number=3)     â† æå–å“åº”ï¼ˆå¦‚æœæ˜¯æ­¥éª¤23æˆ–25ï¼‰
4. ç»§ç»­ä¸‹ä¸€æ­¥

æ­¥éª¤4:
1. send_prompt(prompt, step_number=4)  â† å‘é€æç¤ºè¯
2. wait_for_response(step_number=4)    â† ç­‰å¾…AIå®Œæˆ
3. extract_response(step_number=4)     â† æå–å“åº”ï¼ˆå¦‚æœæ˜¯æ­¥éª¤23æˆ–25ï¼‰
4. ç»§ç»­ä¸‹ä¸€æ­¥
```

### å®é™…ä»£ç æµç¨‹

æŸ¥çœ‹ `process_single_video()` æ–¹æ³•ï¼ˆç¬¬2166-2235è¡Œï¼‰ï¼š

```python
for i, prompt in enumerate(prompts[1:], start=2):
    logger.info(f"ğŸ“ æ­¥éª¤ {i}/{len(prompts)}")
    
    # 1. å‘é€æç¤ºè¯
    if not self.send_prompt(prompt, step_number=i):
        # é”™è¯¯å¤„ç†...
    
    # 2. ç­‰å¾…å“åº”
    response_result = self.wait_for_response(step_number=i)
    
    # 3. å¤„ç†å“åº”ç»“æœ
    if response_result == "rate_limit_switched":
        # åˆ‡æ¢è´¦å·ï¼Œé‡æ–°å¼€å§‹
    elif response_result == "skip":
        # è·³è¿‡
    elif response_result == "quit":
        # é€€å‡º
    
    # 4. ä¿å­˜ç‰¹å®šæ­¥éª¤çš„è¾“å‡º
    if i in config.SAVE_STEPS:  # åªæœ‰æ­¥éª¤23å’Œ25
        response = self.extract_response(step_number=i)
        step_outputs[i] = response
```

## é—®é¢˜æ ¹æº

### 1. `wait_for_response()` çš„åˆ¤æ–­é€»è¾‘

`wait_for_response()` æ–¹æ³•é€šè¿‡ `is_ai_running()` åˆ¤æ–­AIæ˜¯å¦å®Œæˆï¼š

```python
def wait_for_response(self, timeout=None, step_number=None):
    while True:
        # æ£€æŸ¥ AI æ˜¯å¦æ­£åœ¨è¿è¡Œ
        if self.is_ai_running():
            # AI æ­£åœ¨è¿è¡Œï¼Œç»§ç»­ç­‰å¾…
            logger.info(f"â³ AI æ­£åœ¨å¤„ç†... (å·²ç­‰å¾… {elapsed} ç§’)")
            time.sleep(2)
            continue
        else:
            # AI å·²å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š
            logger.info("âœ… AI å¤„ç†å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š...")
            time.sleep(3)  # æˆ–æ­¥éª¤25ç­‰å¾…5ç§’
            break
```

### 2. `is_ai_running()` çš„åˆ¤æ–­æ ‡å‡†

```python
def is_ai_running(self):
    # æŸ¥æ‰¾ Run æŒ‰é’®
    run_button = self.page.locator('button[aria-label="Run"]').first
    
    # è·å–æŒ‰é’®å†…å®¹
    button_html = run_button.inner_html()
    button_class = run_button.get_attribute('class') or ''
    
    # å¦‚æœæŒ‰é’®æ˜¾ç¤º "Stop" æˆ–åŒ…å« stoppable ç±»ï¼Œè¯´æ˜ AI æ­£åœ¨è¿è¡Œ
    if 'Stop' in button_html or 'stoppable' in button_class:
        return True
    
    # å¦‚æœæŒ‰é’®æ˜¾ç¤º "Run"ï¼Œè¯´æ˜ AI å·²å®Œæˆ
    if 'Run' in button_html and 'Stop' not in button_html:
        return False
    
    return False
```

## å¯èƒ½çš„åŸå› 

### åŸå› 1ï¼šRunæŒ‰é’®çŠ¶æ€åˆ¤æ–­ä¸å‡†ç¡® â­â­â­â­â­

**é—®é¢˜**ï¼š
- RunæŒ‰é’®å¯èƒ½åœ¨AIè¿˜åœ¨ç”Ÿæˆæ—¶å°±å˜ä¸ºå¯ç”¨çŠ¶æ€
- æˆ–è€…æŒ‰é’®çŠ¶æ€æ£€æµ‹æœ‰å»¶è¿Ÿ
- æˆ–è€…é€‰æ‹©å™¨æ‰¾ä¸åˆ°æŒ‰é’®ï¼Œé»˜è®¤è¿”å› `False`

**è¯æ®**ï¼š
```
âœ… AI å¤„ç†å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š...  â† wait_for_response() è®¤ä¸ºå®Œæˆäº†
âœ… AI å“åº”å®Œæˆï¼ˆæ€»ç­‰å¾…æ—¶é—´: 20 ç§’ï¼‰
ğŸ“ æ­¥éª¤ 4/25  â† ç«‹å³å¼€å§‹æ­¥éª¤4
```

### åŸå› 2ï¼šå“åº”ç¨³å®šç­‰å¾…æ—¶é—´ä¸å¤Ÿ â­â­â­

**é—®é¢˜**ï¼š
- `wait_for_response()` åœ¨æ£€æµ‹åˆ°RunæŒ‰é’®å¯ç”¨åï¼Œåªç­‰å¾…3ç§’ï¼ˆæ­¥éª¤25ç­‰å¾…5ç§’ï¼‰
- è¿™ä¸ªæ—¶é—´å¯èƒ½ä¸å¤Ÿï¼ŒAIå¯èƒ½è¿˜åœ¨ç”Ÿæˆ

**å½“å‰ä»£ç **ï¼š
```python
else:
    # AI å·²å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š
    logger.info("âœ… AI å¤„ç†å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š...")
    
    if step_number == 25:
        time.sleep(5)
    else:
        time.sleep(3)  â† åªç­‰å¾…3ç§’
    break
```

### åŸå› 3ï¼šæ²¡æœ‰éªŒè¯å“åº”æ˜¯å¦çœŸçš„å®Œæˆ â­â­â­â­

**é—®é¢˜**ï¼š
- `wait_for_response()` åªæ£€æŸ¥æŒ‰é’®çŠ¶æ€ï¼Œä¸æ£€æŸ¥å“åº”å†…å®¹
- æ²¡æœ‰éªŒè¯å“åº”æ˜¯å¦çœŸçš„ç”Ÿæˆå®Œæˆ
- å¯èƒ½RunæŒ‰é’®å¯ç”¨äº†ï¼Œä½†å“åº”è¿˜åœ¨æ¸²æŸ“

**å½“å‰æµç¨‹**ï¼š
```python
# ç­‰å¾…å“åº”
self.wait_for_response(step_number=i)

# ç›´æ¥ç»§ç»­ä¸‹ä¸€æ­¥ï¼ˆæ²¡æœ‰éªŒè¯å“åº”æ˜¯å¦å®Œæ•´ï¼‰
# ä¸‹ä¸€æ­¥çš„ send_prompt() ä¼šç«‹å³å‘é€
```

### åŸå› 4ï¼š`send_prompt()` æ²¡æœ‰æ£€æŸ¥ä¸Šä¸€ä¸ªå“åº” â­â­â­â­â­

**é—®é¢˜**ï¼š
- `send_prompt()` åœ¨å‘é€æ–°æç¤ºè¯å‰ï¼Œæ²¡æœ‰æ£€æŸ¥ä¸Šä¸€ä¸ªå“åº”æ˜¯å¦å®Œæˆ
- åªæ˜¯ç­‰å¾…RunæŒ‰é’®å¯ç”¨ï¼Œç„¶åç«‹å³å‘é€

**å½“å‰ä»£ç **ï¼š
```python
def send_prompt(self, prompt_text, step_number=None):
    # 1. å¡«å…¥æç¤ºè¯
    input_box.fill(prompt_text)
    
    # 2. ç­‰å¾… Run æŒ‰é’®å¯ç”¨
    while waited < max_wait:
        is_disabled = run_button.get_attribute('aria-disabled')
        if is_disabled != 'true':
            break
        time.sleep(0.5)
    
    # 3. ç«‹å³ç‚¹å‡» Run æŒ‰é’®
    run_button.click()
```

**é—®é¢˜**ï¼š
- æ²¡æœ‰æ£€æŸ¥ä¸Šä¸€ä¸ªå“åº”æ˜¯å¦çœŸçš„å®Œæˆ
- åªæ£€æŸ¥æŒ‰é’®æ˜¯å¦å¯ç”¨ï¼ˆ`aria-disabled != 'true'`ï¼‰
- å¯èƒ½ä¸Šä¸€ä¸ªå“åº”è¿˜åœ¨ç”Ÿæˆï¼Œä½†æŒ‰é’®å·²ç»å¯ç”¨äº†

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå¢å¼º `is_ai_running()` çš„åˆ¤æ–­ â­â­â­â­â­

**ç›®æ ‡**ï¼šæ›´å‡†ç¡®åœ°åˆ¤æ–­AIæ˜¯å¦çœŸçš„å®Œæˆ

**æ”¹è¿›**ï¼š
```python
def is_ai_running(self):
    """æ£€æŸ¥ AI æ˜¯å¦æ­£åœ¨è¿è¡Œï¼ˆå¢å¼ºç‰ˆï¼‰"""
    try:
        # æ–¹æ³•1ï¼šæ£€æŸ¥ Run æŒ‰é’®çŠ¶æ€
        run_button = self.page.locator('button[aria-label="Run"]').first
        if run_button.count() > 0:
            button_html = run_button.inner_html()
            button_class = run_button.get_attribute('class') or ''
            aria_disabled = run_button.get_attribute('aria-disabled')
            
            # å¦‚æœæŒ‰é’®æ˜¾ç¤º "Stop"ï¼Œè¯´æ˜æ­£åœ¨è¿è¡Œ
            if 'Stop' in button_html or 'stoppable' in button_class:
                return True
            
            # å¦‚æœæŒ‰é’®è¢«ç¦ç”¨ï¼Œè¯´æ˜æ­£åœ¨è¿è¡Œ
            if aria_disabled == 'true':
                return True
            
            # å¦‚æœæŒ‰é’®æ˜¾ç¤º "Run" ä¸”å¯ç”¨ï¼Œè¯´æ˜å·²å®Œæˆ
            if 'Run' in button_html and aria_disabled != 'true':
                return False
        
        # æ–¹æ³•2ï¼šæ£€æŸ¥æ˜¯å¦æœ‰åŠ è½½æŒ‡ç¤ºå™¨
        loading_selectors = [
            '[role="progressbar"]',
            '.loading',
            '.spinner',
            'text="Generating"',
            'text="ç”Ÿæˆä¸­"',
        ]
        
        for selector in loading_selectors:
            try:
                indicator = self.page.locator(selector).first
                if indicator.count() > 0 and indicator.is_visible():
                    return True
            except:
                continue
        
        # æ–¹æ³•3ï¼šæ£€æŸ¥æœ€åä¸€ä¸ªå“åº”æ˜¯å¦è¿˜åœ¨æ›´æ–°
        try:
            responses = self.page.locator('[data-turn-role="Model"]').all()
            if responses:
                last_response = responses[-1]
                # æ£€æŸ¥æ˜¯å¦æœ‰"æ­£åœ¨è¾“å…¥"çš„æŒ‡ç¤ºå™¨
                typing_indicators = last_response.locator('.typing-indicator, .cursor').all()
                if typing_indicators:
                    return True
        except:
            pass
        
        return False
        
    except Exception as e:
        logger.debug(f"æ£€æŸ¥ AI è¿è¡ŒçŠ¶æ€æ—¶å‡ºé”™: {e}")
        return False
```

### æ–¹æ¡ˆ2ï¼šåœ¨ `wait_for_response()` åéªŒè¯å“åº” â­â­â­â­â­

**ç›®æ ‡**ï¼šç¡®ä¿å“åº”çœŸçš„å®Œæˆäº†

**æ”¹è¿›**ï¼š
```python
def wait_for_response(self, timeout=None, step_number=None):
    # ... ç°æœ‰çš„ç­‰å¾…é€»è¾‘ ...
    
    # AI å·²å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š
    logger.info("âœ… AI å¤„ç†å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š...")
    
    if step_number == 25:
        time.sleep(5)
    else:
        time.sleep(3)
    
    # æ–°å¢ï¼šéªŒè¯å“åº”æ˜¯å¦çœŸçš„å®Œæˆ
    logger.info("ğŸ” éªŒè¯å“åº”æ˜¯å¦å®Œæ•´...")
    if not self.verify_response_complete(step_number):
        logger.warning("âš ï¸ å“åº”å¯èƒ½æœªå®Œæˆï¼Œé¢å¤–ç­‰å¾…5ç§’...")
        time.sleep(5)
        
        # å†æ¬¡éªŒè¯
        if not self.verify_response_complete(step_number):
            logger.warning("âš ï¸ å“åº”ä»æœªå®Œæˆï¼Œä½†ç»§ç»­æ‰§è¡Œ")
    else:
        logger.info("âœ… å“åº”å·²å®Œæ•´")
    
    return None

def verify_response_complete(self, step_number=None):
    """éªŒè¯å“åº”æ˜¯å¦å®Œæ•´"""
    try:
        # æ£€æŸ¥æ˜¯å¦æœ‰å“åº”
        responses = self.page.locator('[data-turn-role="Model"]').all()
        if not responses:
            logger.warning("âš ï¸ æœªæ‰¾åˆ°ä»»ä½•å“åº”")
            return False
        
        # æ£€æŸ¥æœ€åä¸€ä¸ªå“åº”æ˜¯å¦æœ‰å†…å®¹
        last_response = responses[-1]
        text = last_response.inner_text()
        
        if not text or len(text.strip()) == 0:
            logger.warning("âš ï¸ æœ€åä¸€ä¸ªå“åº”ä¸ºç©º")
            return False
        
        # æ£€æŸ¥å“åº”é•¿åº¦æ˜¯å¦åˆç†ï¼ˆè‡³å°‘10ä¸ªå­—ç¬¦ï¼‰
        if len(text.strip()) < 10:
            logger.warning(f"âš ï¸ å“åº”å¤ªçŸ­: {len(text)} å­—ç¬¦")
            return False
        
        # å¦‚æœæ˜¯æ­¥éª¤25ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è¡¨æ ¼
        if step_number == 25:
            tables = last_response.locator('table').all()
            if not tables:
                logger.warning("âš ï¸ æ­¥éª¤25æœªæ‰¾åˆ°è¡¨æ ¼")
                return False
            
            # æ£€æŸ¥è¡¨æ ¼æ˜¯å¦æœ‰æ•°æ®
            table = tables[-1]
            rows = table.locator('tr').count()
            if rows < 2:  # è‡³å°‘æœ‰è¡¨å¤´ + 1è¡Œæ•°æ®
                logger.warning(f"âš ï¸ è¡¨æ ¼æ•°æ®ä¸è¶³: {rows} è¡Œ")
                return False
        
        return True
        
    except Exception as e:
        logger.warning(f"âš ï¸ éªŒè¯å“åº”æ—¶å‡ºé”™: {e}")
        return False
```

### æ–¹æ¡ˆ3ï¼šåœ¨ `send_prompt()` å‰æ£€æŸ¥ä¸Šä¸€ä¸ªå“åº” â­â­â­â­

**ç›®æ ‡**ï¼šç¡®ä¿ä¸Šä¸€ä¸ªå“åº”å®Œæˆåå†å‘é€æ–°æç¤ºè¯

**æ”¹è¿›**ï¼š
```python
def send_prompt(self, prompt_text, step_number=None):
    step_info = f"æ­¥éª¤ {step_number}" if step_number else "æç¤ºè¯"
    logger.info(f"ğŸ“ å‘é€{step_info}: {prompt_text[:50]}...")
    
    try:
        # æ–°å¢ï¼šå¦‚æœä¸æ˜¯ç¬¬ä¸€æ­¥ï¼Œæ£€æŸ¥ä¸Šä¸€ä¸ªå“åº”æ˜¯å¦å®Œæˆ
        if step_number and step_number > 1:
            logger.info("ğŸ” æ£€æŸ¥ä¸Šä¸€ä¸ªå“åº”æ˜¯å¦å®Œæˆ...")
            
            # ç­‰å¾…ä¸Šä¸€ä¸ªå“åº”å®Œæˆï¼ˆæœ€å¤šç­‰å¾…10ç§’ï¼‰
            max_wait = 10
            waited = 0
            while waited < max_wait:
                if self.verify_response_complete(step_number - 1):
                    logger.info("âœ… ä¸Šä¸€ä¸ªå“åº”å·²å®Œæˆ")
                    break
                
                logger.info(f"â³ ç­‰å¾…ä¸Šä¸€ä¸ªå“åº”å®Œæˆ... ({waited}/{max_wait} ç§’)")
                time.sleep(1)
                waited += 1
            
            if waited >= max_wait:
                logger.warning("âš ï¸ ç­‰å¾…ä¸Šä¸€ä¸ªå“åº”è¶…æ—¶ï¼Œä½†ç»§ç»­å‘é€")
        
        # æŸ¥æ‰¾è¾“å…¥æ¡†
        input_box = None
        for selector in input_selectors:
            # ... ç°æœ‰é€»è¾‘ ...
        
        # å¡«å…¥æç¤ºè¯
        input_box.fill(prompt_text)
        
        # ç­‰å¾… Run æŒ‰é’®å¯ç”¨
        # ... ç°æœ‰é€»è¾‘ ...
        
        # ç‚¹å‡» Run æŒ‰é’®
        run_button.click()
        
        return True
        
    except Exception as e:
        logger.error(f"âŒ å‘é€æç¤ºè¯å¤±è´¥: {e}")
        return False
```

### æ–¹æ¡ˆ4ï¼šå¢åŠ å“åº”ç¨³å®šç­‰å¾…æ—¶é—´ â­â­â­

**ç›®æ ‡**ï¼šç»™å“åº”æ›´å¤šæ—¶é—´å®Œæˆ

**æ”¹è¿›**ï¼š
```python
def wait_for_response(self, timeout=None, step_number=None):
    # ... ç°æœ‰çš„ç­‰å¾…é€»è¾‘ ...
    
    else:
        # AI å·²å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š
        logger.info("âœ… AI å¤„ç†å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š...")
        
        # å¢åŠ ç­‰å¾…æ—¶é—´
        if step_number == 25:
            logger.info("ğŸ“Š æ­¥éª¤25ï¼šç­‰å¾…è¡¨æ ¼æ¸²æŸ“ï¼ˆ10ç§’ï¼‰...")
            time.sleep(10)  # ä»5ç§’å¢åŠ åˆ°10ç§’
        else:
            time.sleep(5)  # ä»3ç§’å¢åŠ åˆ°5ç§’
        break
```

## æ¨èæ–¹æ¡ˆ

### ç»¼åˆæ–¹æ¡ˆï¼ˆæ¨èï¼‰â­â­â­â­â­

ç»“åˆæ–¹æ¡ˆ1ã€2ã€3ï¼Œç¡®ä¿æ¯ä¸ªæ­¥éª¤éƒ½å®Œæ•´æ‰§è¡Œï¼š

1. **å¢å¼º `is_ai_running()`**ï¼šæ›´å‡†ç¡®åœ°åˆ¤æ–­AIçŠ¶æ€
2. **åœ¨ `wait_for_response()` åéªŒè¯**ï¼šç¡®ä¿å“åº”å®Œæ•´
3. **åœ¨ `send_prompt()` å‰æ£€æŸ¥**ï¼šç¡®ä¿ä¸Šä¸€ä¸ªå“åº”å®Œæˆ

**ä¼˜ç‚¹**ï¼š
- âœ… å¤šå±‚éªŒè¯ï¼Œç¡®ä¿ä¸è·³è¿‡æ­¥éª¤
- âœ… ä¸ä¾èµ–å›ºå®šç­‰å¾…æ—¶é—´
- âœ… æ›´å¯é ï¼Œæ›´æ™ºèƒ½

**å®æ–½æ­¥éª¤**ï¼š
1. ä¿®æ”¹ `is_ai_running()` - å¢åŠ å¤šç§åˆ¤æ–­æ–¹æ³•
2. æ·»åŠ  `verify_response_complete()` - éªŒè¯å“åº”å®Œæ•´æ€§
3. ä¿®æ”¹ `wait_for_response()` - æ·»åŠ å“åº”éªŒè¯
4. ä¿®æ”¹ `send_prompt()` - æ·»åŠ ä¸Šä¸€ä¸ªå“åº”æ£€æŸ¥

## è°ƒè¯•å»ºè®®

### 1. å¢åŠ è¯¦ç»†æ—¥å¿—

åœ¨å…³é”®ä½ç½®æ·»åŠ æ—¥å¿—ï¼š

```python
def wait_for_response(self, timeout=None, step_number=None):
    logger.info(f"â³ ç­‰å¾… AI å“åº”{step_info}...")
    
    while True:
        # æ·»åŠ è¯¦ç»†æ—¥å¿—
        is_running = self.is_ai_running()
        logger.debug(f"ğŸ” is_ai_running() = {is_running}")
        
        if is_running:
            logger.info(f"â³ AI æ­£åœ¨å¤„ç†... (å·²ç­‰å¾… {elapsed} ç§’)")
        else:
            logger.info("âœ… AI å¤„ç†å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š...")
            
            # æ·»åŠ æŒ‰é’®çŠ¶æ€æ—¥å¿—
            run_button = self.page.locator('button[aria-label="Run"]').first
            if run_button.count() > 0:
                button_html = run_button.inner_html()
                aria_disabled = run_button.get_attribute('aria-disabled')
                logger.debug(f"ğŸ” RunæŒ‰é’®çŠ¶æ€: html={button_html[:50]}, disabled={aria_disabled}")
            
            break
```

### 2. æˆªå›¾è®°å½•

åœ¨å…³é”®æ—¶åˆ»æˆªå›¾ï¼š

```python
# åœ¨ wait_for_response() æ£€æµ‹åˆ°å®Œæˆæ—¶
logger.info("âœ… AI å¤„ç†å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š...")
self.take_screenshot(f"step_{step_number}_ai_complete")

# ç­‰å¾…ç¨³å®šå
time.sleep(3)
self.take_screenshot(f"step_{step_number}_response_stable")

# åœ¨ send_prompt() å‘é€å‰
logger.info(f"ğŸ“ å‘é€{step_info}...")
self.take_screenshot(f"step_{step_number}_before_send")
```

### 3. ä¿å­˜HTML

ä¿å­˜é¡µé¢HTMLç”¨äºåˆ†æï¼š

```python
# åœ¨æ£€æµ‹åˆ°é—®é¢˜æ—¶
logger.warning("âš ï¸ æ£€æµ‹åˆ°å¯èƒ½çš„é—®é¢˜")
html_content = self.page.content()
with open(f"debug_step_{step_number}.html", "w", encoding="utf-8") as f:
    f.write(html_content)
logger.info(f"ğŸ’¾ å·²ä¿å­˜HTML: debug_step_{step_number}.html")
```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. è¿è¡Œç¨‹åºï¼Œè§‚å¯Ÿæ—¥å¿—
2. ç‰¹åˆ«å…³æ³¨æ­¥éª¤3å’Œæ­¥éª¤4ä¹‹é—´çš„æ—¥å¿—
3. æ£€æŸ¥æ˜¯å¦æœ‰ä»¥ä¸‹æ—¥å¿—ï¼š
   ```
   âœ… AI å¤„ç†å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š...  â† æ­¥éª¤3
   âœ… AI å“åº”å®Œæˆï¼ˆæ€»ç­‰å¾…æ—¶é—´: X ç§’ï¼‰
   ğŸ“ æ­¥éª¤ 4/25  â† æ­¥éª¤4
   ```
4. å¦‚æœæ­¥éª¤4åœ¨æ­¥éª¤3å®Œæˆå‰å°±å¼€å§‹ï¼Œè¯´æ˜é—®é¢˜ä»å­˜åœ¨

### é¢„æœŸç»“æœ

ä¿®å¤ååº”è¯¥çœ‹åˆ°ï¼š
```
â³ ç­‰å¾… AI å“åº”æ­¥éª¤ 3...
â³ AI æ­£åœ¨å¤„ç†... (å·²ç­‰å¾… 10 ç§’)
â³ AI æ­£åœ¨å¤„ç†... (å·²ç­‰å¾… 20 ç§’)
âœ… AI å¤„ç†å®Œæˆï¼Œç­‰å¾…å“åº”ç¨³å®š...
ğŸ” éªŒè¯å“åº”æ˜¯å¦å®Œæ•´...
âœ… å“åº”å·²å®Œæ•´
âœ… AI å“åº”å®Œæˆï¼ˆæ€»ç­‰å¾…æ—¶é—´: 25 ç§’ï¼‰

ğŸ“ æ­¥éª¤ 4/25
ğŸ” æ£€æŸ¥ä¸Šä¸€ä¸ªå“åº”æ˜¯å¦å®Œæˆ...
âœ… ä¸Šä¸€ä¸ªå“åº”å·²å®Œæˆ
ğŸ“ å‘é€æ­¥éª¤ 4: ...
```

## æ€»ç»“

**é—®é¢˜æ ¹æº**ï¼š
- `is_ai_running()` å¯èƒ½åˆ¤æ–­ä¸å‡†ç¡®
- `wait_for_response()` æ²¡æœ‰éªŒè¯å“åº”å®Œæ•´æ€§
- `send_prompt()` æ²¡æœ‰æ£€æŸ¥ä¸Šä¸€ä¸ªå“åº”

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. âœ… å¢å¼º `is_ai_running()` çš„åˆ¤æ–­é€»è¾‘
2. âœ… åœ¨ `wait_for_response()` åéªŒè¯å“åº”
3. âœ… åœ¨ `send_prompt()` å‰æ£€æŸ¥ä¸Šä¸€ä¸ªå“åº”
4. âœ… å¢åŠ è¯¦ç»†æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯

**ä¸‹ä¸€æ­¥**ï¼š
1. å®æ–½ç»¼åˆæ–¹æ¡ˆ
2. æµ‹è¯•éªŒè¯
3. è§‚å¯Ÿæ—¥å¿—
4. æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´

