# 错误恢复使用指南

> v1.5.0 新增功能：交互式错误处理和流程控制

---

## 📖 概述

v1.5.0 引入了强大的错误恢复机制，让你在遇到任何错误时都能：
- ✅ 不崩溃，不退出
- ✅ 手动处理错误
- ✅ 从任意步骤继续
- ✅ 循环处理多批次

---

## 🎯 核心功能

### 1. 错误暂停

当程序遇到错误时，会**暂停**而不是崩溃：

```
============================================================
❌ 错误: 上传视频超时
============================================================
📍 当前步骤: 1

可选操作:
  1. 输入步骤号 (1-25) - 从指定步骤继续
  2. 输入 'retry' - 重试当前步骤
  3. 输入 'skip' - 跳过当前视频
  4. 输入 'quit' - 退出程序
  5. 直接按 Enter - 继续下一步

👉 请输入操作: 
```

### 2. 用户操作

你有 5 种选择：

| 操作 | 说明 | 使用场景 |
|------|------|----------|
| **步骤号** (1-25) | 从指定步骤继续 | 想跳过某些步骤，或重新执行特定步骤 |
| **retry** | 重试当前步骤 | 临时错误，重试可能成功 |
| **skip** | 跳过当前视频 | 视频有问题，无法处理 |
| **quit** | 退出程序 | 需要修改代码或配置 |
| **Enter** | 继续下一步 | 已手动处理，继续执行 |

---

## 📚 使用场景

### 场景1：网络超时

**问题**：上传视频时网络超时

**解决方案**：

```bash
# 程序显示
❌ 错误: 上传视频超时
📍 当前步骤: 1

# 方案A：重试
👉 请输入操作: retry
🔄 重试当前步骤...
[重新上传视频]

# 方案B：等待网络恢复后继续
[等待网络恢复]
👉 请输入操作: 1
↪️ 从步骤 1 继续...
[重新上传视频]
```

---

### 场景2：AI 响应异常

**问题**：步骤 15 的 AI 响应格式错误

**解决方案**：

```bash
# 程序显示
❌ 错误: 步骤 15 解析失败
📍 当前步骤: 15

# 方案A：重试该步骤
👉 请输入操作: retry
🔄 重试当前步骤...

# 方案B：跳过该步骤，继续下一步
👉 请输入操作: [Enter]
✅ 继续执行...
[执行步骤 16]

# 方案C：从步骤 15 重新开始
👉 请输入操作: 15
↪️ 从步骤 15 继续...
```

---

### 场景3：Content Blocked

**问题**：AI 返回 "Content blocked"

**解决方案**：

```bash
# 程序显示
❌ 错误: Content blocked
📍 当前步骤: 10

# 在浏览器中手动处理：
# 1. 查看 AI 的响应
# 2. 点击 "继续" 或修改提示词
# 3. 等待 AI 重新生成

# 处理完成后
👉 请输入操作: [Enter]
✅ 继续执行...
[继续步骤 11]
```

---

### 场景4：手动干预

**问题**：需要在浏览器中手动操作

**解决方案**：

```bash
# 程序显示
❌ 错误: 找不到按钮
📍 当前步骤: 5

# 在浏览器中手动操作：
# 1. 手动点击按钮
# 2. 手动输入文字
# 3. 手动触发操作

# 操作完成后
👉 请输入操作: [Enter]
✅ 继续执行...
[继续步骤 6]
```

---

### 场景5：跳过问题视频

**问题**：某个视频无法处理

**解决方案**：

```bash
# 程序显示
❌ 错误: 视频格式不支持
📍 当前步骤: 1

# 跳过该视频
👉 请输入操作: skip
⏭️ 跳过当前视频...

# 继续处理下一个视频
[处理 video2.mp4]
```

---

### 场景6：调试特定步骤

**问题**：步骤 20 总是失败，需要调试

**解决方案**：

```bash
# 第一次运行
[执行到步骤 20]
❌ 错误: 步骤 20 失败
📍 当前步骤: 20

# 修改代码或配置
👉 请输入操作: quit
👋 退出程序...

[修改代码]

# 第二次运行，直接跳到步骤 20
python video_automation.py
[执行到步骤 19]
❌ 错误: [手动触发错误]
👉 请输入操作: 20
↪️ 从步骤 20 继续...
[测试步骤 20]
```

---

## 🔄 循环执行模式

### 基本用法

```bash
# 启动程序
python video_automation.py

# 第一批：处理 3 个视频
[处理 video1.mp4]
[处理 video2.mp4]
[处理 video3.mp4]

🎉 本批次任务完成！
✅ 成功处理: 3/3 个视频

📋 批次完成，请选择下一步操作
可选操作:
  1. 输入 'continue' 或按 Enter - 重新加载 VideoList.csv 并继续
  2. 输入 'quit' - 退出程序

# 更新 VideoList.csv，添加下一批视频
[编辑 VideoList.csv]

# 继续下一批
👉 请输入操作: continue
🔄 重新加载视频列表...

# 第二批：处理 2 个视频
[处理 video4.mp4]
[处理 video5.mp4]

🎉 本批次任务完成！
✅ 成功处理: 2/2 个视频

# 全部完成，退出
👉 请输入操作: quit
👋 退出程序...
```

---

### 批量处理策略

#### 策略1：小批次处理

**适用场景**：网络不稳定，容易出错

```bash
# 每批 3-5 个视频
# 降低单次失败的影响

第一批: video1-5
第二批: video6-10
第三批: video11-15
...
```

**优点**：
- ✅ 单次失败影响小
- ✅ 容易恢复
- ✅ 可以随时停止

---

#### 策略2：大批次处理

**适用场景**：网络稳定，视频简单

```bash
# 每批 10-20 个视频
# 提高处理效率

第一批: video1-20
第二批: video21-40
第三批: video41-60
...
```

**优点**：
- ✅ 处理效率高
- ✅ 减少人工干预
- ✅ 节省时间

---

#### 策略3：混合处理

**适用场景**：视频复杂度不同

```bash
# 简单视频：大批次
第一批: simple_video1-20

# 复杂视频：小批次
第二批: complex_video1-5
第三批: complex_video6-10

# 测试视频：单个处理
第四批: test_video1
```

**优点**：
- ✅ 灵活调整
- ✅ 针对性处理
- ✅ 平衡效率和稳定性

---

## 💡 最佳实践

### 1. 错误处理原则

```
1. 先尝试 'retry' 重试
   ↓ 失败
2. 检查浏览器状态
   ↓ 发现问题
3. 手动处理后按 Enter
   ↓ 仍然失败
4. 输入步骤号重新执行
   ↓ 还是失败
5. 输入 'skip' 跳过
```

---

### 2. 批次处理原则

```
1. 首次运行：小批次（3-5个）
   ↓ 测试稳定性
2. 稳定后：中批次（10个）
   ↓ 提高效率
3. 非常稳定：大批次（20个）
   ↓ 最大化效率
4. 遇到问题：回到小批次
```

---

### 3. 日志查看

```bash
# 实时查看日志
tail -f automation.log

# 查看错误
grep "❌" automation.log

# 查看特定步骤
grep "步骤 15" automation.log

# 查看成功率
grep "✅ 成功处理" automation.log
```

---

### 4. 截图检查

```bash
# 查看截图
ls -lt screenshots/

# 查看错误截图
ls screenshots/error_*

# 查看特定步骤截图
ls screenshots/step_15_*
```

---

## 🔧 故障排除

### 问题1：程序无响应

**症状**：输入操作后没有反应

**解决方案**：
```bash
# 1. 检查是否在等待输入
# 2. 按 Ctrl+C 中断
# 3. 重新启动程序
```

---

### 问题2：无法恢复

**症状**：输入步骤号后仍然失败

**解决方案**：
```bash
# 1. 输入 'quit' 退出
# 2. 检查浏览器状态
# 3. 重新启动程序
# 4. 从步骤 1 开始
```

---

### 问题3：数据丢失

**症状**：重新执行后之前的数据不见了

**解决方案**：
```bash
# 数据保存在：
assets/Process_Folder/[视频名]/step_XX_output.xlsx

# 检查是否存在：
ls assets/Process_Folder/*/step_*

# 如果丢失，从该步骤重新执行
```

---

## 📊 效果对比

### 之前（v1.4.x）

```
启动程序
  ↓
处理 video1 ✅
  ↓
处理 video2 ✅
  ↓
处理 video3 ❌ [崩溃]
  ↓
程序退出
  ↓
重新启动
  ↓
从 video1 重新开始 😢
```

**问题**：
- ❌ 浪费时间
- ❌ 重复工作
- ❌ 效率低下

---

### 现在（v1.5.0）

```
启动程序
  ↓
处理 video1 ✅
  ↓
处理 video2 ✅
  ↓
处理 video3 ❌ [暂停]
  ↓
用户处理错误
  ↓
继续/重试/跳过
  ↓
处理 video4 ✅
  ↓
批次完成
  ↓
更新 VideoList.csv
  ↓
继续下一批 😊
```

**优势**：
- ✅ 不浪费时间
- ✅ 不重复工作
- ✅ 高效稳定

---

## 🎉 总结

v1.5.0 的错误恢复机制让视频处理自动化更加：

1. ✅ **可靠** - 不会因为错误而崩溃
2. ✅ **灵活** - 支持多种恢复方式
3. ✅ **高效** - 循环执行，批量处理
4. ✅ **友好** - 清晰的提示和操作
5. ✅ **智能** - 保留已完成的工作

**让你的视频处理工作更加轻松！**

---

**版本**: v1.5.0  
**更新日期**: 2024-12-05  
**文档类型**: 使用指南
